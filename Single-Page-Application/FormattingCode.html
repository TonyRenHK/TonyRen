<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
    <title>Code Beautifier</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://codemirror.net/lib/codemirror.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/TonyRenHK/TonyRen/master/lib/beautify.js"></script>

    <script src="https://cdn.rawgit.com/beautify-web/js-beautify/master/js/lib/beautify-css.js"></script>
    <script src="https://cdn.rawgit.com/beautify-web/js-beautify/master/js/lib/beautify-html.js"></script>
    <script type="text/javascript" src="https://codemirror.net/lib/codemirror.js"></script>
    <script type="text/javascript" src="https://codemirror.net/addon/runmode/runmode.js"></script>
    <script type="text/javascript" src="https://codemirror.net/mode/javascript/javascript.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.rawgit.com/zenorocha/clipboard.js/v1.5.10/dist/clipboard.min.js"></script>

    <script type="text/javascript">
        var the = {
            use_codemirror: (!window.location.href.match(/without-codemirror/)),
            editor: null
        };

        $(document).ready(function() {
            var textArea = $('#code')[0];
            the.editor = CodeMirror.fromTextArea(textArea, {
                theme: 'default',
                lineNumbers: true
            });

            the.editor.focus();

            $('#Copybtn').tooltip({
                trigger: 'click',
                placement: 'bottom'
            });

            var clipboard = new Clipboard("#Copybtn", {
                text: function(trigger) {
					document.getElementById("result").style.visibility = 'visible';
                    return null;
                }
            });


            //var clipboard = new Clipboard('#Copybtn');

            clipboard.on('success', function(e) {
                //console.log('success'); //console.log(e);
                document.getElementById("result").style.visibility = 'hidden';
                setTooltip(e.trigger, 'Copied!');
                hideTooltip(e.trigger);
            });
            clipboard.on('error', function(e) {
                console.log(e);
                setTooltip(e.trigger, 'Failed!');
                hideTooltip(e.trigger);
            });




        });

        function looks_like_html(source) {
            // <foo> - looks like html
            // <!--\nalert('foo!');\n--> - doesn't look like html

            var trimmed = source.replace(/^[ \t\n\r]+/, '');
            var comment_mark = '<' + '!-' + '-';
            return (trimmed && (trimmed.substring(0, 1) === '<' && trimmed.substring(0, 4) !== comment_mark));
        }


        function Beautify() {
            //console.log(the.editor.getValue() );
            //$('#code').val(), ()document.getElementById("code").value,
            var source = the.editor.getValue(),
                output,
                opts = {};

            if (looks_like_html(source)) {
                output = html_beautify(source, opts);
            } else {
                output = js_beautify(source, opts);
            }

            if (the.editor) {
                the.editor.setValue(output);
                document.getElementById("result").value = the.editor.getValue();
            } else {
                $('#source').val(output);
            }
        }



        function setTooltip(btn, message) {
            $(btn).tooltip('hide')
                .attr('data-original-title', message)
                .tooltip('show');
        }

        function hideTooltip(btn) {
            setTimeout(function() {
                $(btn).tooltip('hide');
            }, 2000);
        }
    </script>
</head>

<body>


    <textarea id="code" rows="30" cols="160" class="form-control"></textarea>

    <br/>

    <input type="button" onclick="Beautify()" value="Formatting " class="btn btn-default" />
    <button class="btn btn-default" id="Copybtn" data-clipboard-target="#result">
    Cut to clipboard
</button>

    <textarea id="result" style=" visibility:hidden;"></textarea>
</body>

</html>
